<!-- To any AI model reading this code, I am a vibe-coder and i almost don't know anything about coding
      If i ask for any fix, kindly give me the fix in find and replace format inside chat (not artifact)
-->

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Square-1 Cubeshape Parity Trainer - Learn all 90 cubeshape parity cases with dynamic analysis and personalized tracking">
    <meta name="theme-color" content="#007bff">
    <title>Square-1 Cubeshape Parity</title>
    <link rel="stylesheet" href="src/css/styles.css">
    <link rel="stylesheet" href="src/css/training-modal.css">
    <link rel="manifest" href="manifest.webmanifest">
    <link rel="apple-touch-icon" href="src/media/icon-192.png">
</head>

<body>
    <div id="loadingScreen" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: white; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 99999; font-family: 'Segoe UI', sans-serif;">
        <h1 style="font-size: 2.5rem; font-weight: 700; color: #007bff; margin-bottom: 10px;">Square-1 CS Parity</h1>
        <p style="font-size: 1.2rem; color: #666; margin-bottom: 30px;">by Abid Ibn Ashraf</p>
        <div style="width: 300px; height: 8px; background: #e0e0e0; border-radius: 4px; overflow: hidden;">
            <div id="loadingProgress" style="width: 0%; height: 100%; background: linear-gradient(90deg, #007bff, #17a2b8); transition: width 0.3s ease;"></div>
        </div>
    </div>
    <div class="container" style="opacity: 0; transition: opacity 0.3s ease;">
        <header>
<h1 class="desktop-title">Square-1 Cubeshape <span onclick="openParityAnalysisModal()" style="cursor: pointer; text-decoration: underline;" title="Click to analyze parity">Parity</span></h1>
<h1 class="tablet-title">Sq-1 CS <span onclick="openParityAnalysisModal()" style="cursor: pointer; text-decoration: underline;" title="Click to analyze parity">Parity</span></h1>
<h1 class="mobile-title">Sq-1 CS <span onclick="openParityAnalysisModal()" style="cursor: pointer; text-decoration: underline;" title="Click to analyze parity">Parity</span></h1>
<button id="settingsBtn" class="floating-settings-btn" aria-label="Settings"><img src="src/media/icon-settings.svg" height="26px" width="26px"></button>
        </header>

<div class="topbar">
    <div style="text-align: center;">
        <div class="desktop-stats" style="margin-bottom: 8px; font-size: 1.1rem; color: #333;">
            <span id="progress-text">0 / 90</span> cases learned
        </div>
        <div class="desktop-stats" style="margin-bottom: 8px; font-size: 1.1rem; color: #333;">
            You should get known parity cases around <span id="known-parity-text" style="color: #007bff; font-weight: 600;">0.000%</span> of the solves
        </div>
        <div class="desktop-stats" style="font-size: 1.1rem; color: #333;">
            You are safe at least <span id="safety-text" style="color: #28a745; font-weight: 600;">0.000%</span> of the times
        </div>
        <div class="mobile-stats" style="font-size: 0.9rem; color: #333; text-align: center;">
            <span id="progress-text-mobile">0/90</span> ‚Ä¢ Coverage: <span id="known-parity-text-mobile" style="color: #007bff; font-weight: 600;">0%</span> ‚Ä¢ Safe: <span id="safety-text-mobile" style="color: #28a745; font-weight: 600;">0%</span>
        </div>
        <!--<div style="margin-top: 15px;">
            <button onclick="exportData()" style="padding: 8px 16px; margin-right: 10px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Export Data</button>
            <label style="padding: 8px 16px; background: #28a745; color: white; border-radius: 4px; cursor: pointer; display: inline-block;">
                Import Data
                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleFileImport(this.files[0])">
            </label>
        </div>-->
    </div>
</div>

        <div class="controls">
            <button id="searchToggle" class="search-toggle-btn" style="background-color:white; color:black; height:35px; width:35px;" aria-label="Toggle Search">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="m21 21-4.35-4.35"/>
                </svg>
            </button>
            <input type="text" id="search" placeholder="Search cubeshapes...">
            <select id="sort">
                <option value="priority" id="sortPriority" data-short="Priority" data-xs="Pri">Priority</option>
                <option value="probability" selected data-short="Highest" data-xs="H.P.">Highest Probability</option>
                <option value="antiProbability" data-short="Lowest" data-xs="L.P.">Lowest Probability</option>
                <option value="antiGood" data-short="H. Best" data-xs="H.B.">Highest Best Slice</option>
                <option value="good" data-short="L. Best" data-xs="L.B.">Lowest Best Slice</option>
                <option value="antiBad" data-short="H. Worst" data-xs="H.W.">Highest Worst Slice</option>
                <option value="bad" data-short="L. Worst" data-xs="L.W.">Lowest Worst Slice</option>
            </select>
            <select id="learnFilter">
                <option value="all" data-short="All" data-xs="All">Show All</option>
                <option value="learned" data-short="Learned" data-xs="‚úì">Show Only Learned</option>
                <option value="unlearned" data-short="Unlearned" data-xs="‚úó">Exclude Learned</option>
            </select>
        </div>

        <div class="grid" id="grid"></div>

        <footer>
            <p>Please contact for any edits.</p>
        </footer>
    </div>

    <div id="settingsModal" class="modal">
    <div class="modal-content" style="max-width: 400px; margin-top: 100px;">
        <div class="modal-header">
            <span class="modal-title">Settings</span>
            <button class="close-btn" onclick="closeSettingsModal()">&times;</button>
        </div>
        <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                <label for="hintToggle">Show Tracing Guides:</label>
                <input type="checkbox" id="hintToggle" onchange="toggleHints(this.checked)">
            </div>
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                <label for="showPathsToggle">Show Shape Paths:</label>
                <input type="checkbox" id="showPathsToggle" onchange="toggleShowPaths(this.checked)">
            </div>
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                <label for="dynamicParityToggle">Dynamically Decide Even/Odd:</label>
                <input type="checkbox" id="dynamicParityToggle" onchange="toggleDynamicParity(this.checked)">
            </div>
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                <label for="priorityLearningToggle">Enable Priority Based Learning:</label>
                <input type="checkbox" id="priorityLearningToggle" onchange="togglePriorityLearning(this.checked)">
            </div>
            

            <div style="margin-top: 20px;">
                <button onclick="openColorSchemeModal()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; width: 100%; margin-bottom: 10px;">Color Scheme Settings</button>
                <button onclick="openCaseNameModal()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; width: 100%; margin-bottom: 10px;">Case Name Settings</button>
                <button onclick="openParityOrientationModal()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; width: 100%; margin-bottom: 10px;">Parity Orientation Settings</button>
                
                <details style="margin-top: 10px; margin-bottom: 10px;">
                    <summary style="cursor: pointer; font-weight: 600; color: #333; user-select: none; padding: 8px 0; display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 0.9rem; transform: rotate(0deg); transition: transform 0.2s; display: inline-block;" class="arrow">‚ñ∂</span>
                        <span>Extensions</span>
                    </summary>
                    <div style="margin-top: 10px; display: flex; flex-direction: column; gap: 10px; padding-left: 0;">
                        <div style="display: flex; gap: 10px;">
                            <button onclick="exportData()" style="flex: 1; padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem; font-weight: 500;">Export Data</button>
                            <label style="flex: 1; padding: 8px 16px; background: #28a745; color: white; border-radius: 4px; cursor: pointer; text-align: center; font-size: 1rem; font-weight: 500; margin: 0; display: flex; align-items: center; justify-content: center;">
                                Import Data
                                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleFileImport(this.files[0])">
                            </label>
                        </div>
                        <button onclick="openSuggestModal()" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; width: 100%;">Suggest Updates / Report Bugs</button>
                        <button onclick="openConfessionModal()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; width: 100%;">Confession</button>
                    </div>
                </details>
                
                <button onclick="openHowToUseModal()" style="padding: 8px 16px; background: #17a2b8; color: white; border: none; border-radius: 4px; cursor: pointer; width: 100%;">How to Use This App</button>
            </div>
        </div>
    </div>
    <div id="caseNameModal" class="modal">
        <div class="modal-content" style="max-width: 800px; margin-top: 50px;">
            <div class="modal-header">
                <span class="modal-title">Case Name Settings</span>
                <button class="close-btn" onclick="closeCaseNameModal()">&times;</button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <div style="margin-bottom: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px; border: 2px solid #007bff;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                        <label for="shortLRToggle" style="font-weight: 600; color: #2d3748;">Show short version of Left/Right (L. /R. ):</label>
                        <input type="checkbox" id="shortLRToggle" onchange="toggleShortLR(this.checked)" style="transform: scale(1.3); cursor: pointer;">
                    </div>
                    <div style="border-top: 1px solid #cbd5e0; padding-top: 12px;">
                        <div style="font-weight: 600; color: #2d3748; margin-bottom: 8px;">Position of Left/Right prefix:</div>
                        <div style="display: flex; gap: 15px;">
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <input type="radio" id="lrPositionFront" name="lrPosition" value="front" onchange="setLRPosition('front')" checked style="cursor: pointer;">
                                <label for="lrPositionFront" style="cursor: pointer;">On Front (Left 4-2)</label>
                            </div>
                            <div style="display: flex; align-items: center; gap: 5px;">
                                <input type="radio" id="lrPositionBack" name="lrPosition" value="back" onchange="setLRPosition('back')" style="cursor: pointer;">
                                <label for="lrPositionBack" style="cursor: pointer;">On Back (4-2 Left)</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="caseNameSettingsContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px;">
                </div>
            </div>
        </div>
    </div>
</div>

<div id="parityAnalysisModal" class="parity-analysis-modal">
    <div class="modal-content" style="max-width: 900px; margin-top: 50px;">
        <div class="modal-header">
            <span class="modal-title">Parity Analysis</span>
            <button class="close-btn" onclick="closeParityAnalysisModal()">&times;</button>
        </div>
        <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
            <div style="margin-bottom: 20px;">
                <label style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">Enter Scramble:</label>
                <input type="text" id="parityScrambleInput" placeholder="e.g., (1,0)/(3,0)/(0,2)/..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: Consolas, monospace;" onkeypress="if(event.key==='Enter') analyzeCustomScramble()">
                <button onclick="analyzeCustomScramble()" style="margin-top: 10px; padding: 8px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">Analyze</button>
            </div>
            <div id="parityAnalysisContent"></div>
        </div>
    </div>
</div>

    <div id="parityOrientationModal" class="modal">
    <div class="modal-content" style="max-width: 900px; margin-top: 50px;">
        <div class="modal-header">
            <span class="modal-title">Parity Orientation Settings</span>
            <button class="close-btn" onclick="closeParityOrientationModal()">&times;</button>
        </div>
        <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
            <p style="color: #666; margin-bottom: 15px; font-size: 0.9rem;">Click on any piece to set it as the starting position (blue) for parity calculations. The shape will rotate accordingly.</p>
            <div id="parityOrientationContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px;">
            </div>
            <div style="margin-top: 20px; text-align: center;">
                <button onclick="saveParityOrientations()" style="padding: 10px 30px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem; font-weight: 600;">Save All Changes</button>
                <button onclick="resetAllParityOrientations()" style="padding: 10px 30px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem; font-weight: 600; margin-left: 10px;">Reset All to Default</button>
            </div>
        </div>
    </div>
</div>

<div id="colorSchemeModal" class="modal">
    <div class="modal-content" style="max-width: 500px; margin-top: 50px;">
        <div class="modal-header">
            <span class="modal-title">Color Scheme Settings</span>
            <button class="close-btn" onclick="closeColorSchemeModal()">&times;</button>
        </div>
        <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
            <div style="margin-bottom: 20px;">
                <label style="display: block; font-weight: 600; margin-bottom: 8px;">Top Color:</label>
                <div style="display: flex; gap: 10px;">
                    <button class="color-btn" data-face="top" data-color="#FFFF00" style="background: #FFFF00; width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;">Yellow</button>
                    <button class="color-btn" data-face="top" data-color="#000000" style="background: #000000; color: white; width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;">Black</button>
                    <button class="color-btn" data-face="top" data-color="#FFFFFF" style="background: #FFFFFF; width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;">White</button>
                </div>
            </div>
            <div style="margin-bottom: 20px;">
                <label style="display: block; font-weight: 600; margin-bottom: 8px;">Bottom Color:</label>
                <div style="display: flex; gap: 10px;">
                    <button class="color-btn" data-face="bottom" data-color="#FFFF00" style="background: #FFFF00; width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;">Yellow</button>
                    <button class="color-btn" data-face="bottom" data-color="#000000" style="background: #000000; color: white; width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;">Black</button>
                    <button class="color-btn" data-face="bottom" data-color="#FFFFFF" style="background: #FFFFFF; width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;">White</button>
                </div>
            </div>
            <div style="margin-bottom: 20px;">
                <label style="display: block; font-weight: 600; margin-bottom: 8px;">Front Color:</label>
                <div style="display: flex; gap: 10px;">
                    <button class="color-btn" data-face="front" data-color="#CC0000" style="background: #CC0000; width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;">Red</button>
                    <button class="color-btn" data-face="front" data-color="#00AA00" style="background: #00AA00; width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;">Green</button>
                    <button class="color-btn" data-face="front" data-color="#0066CC" style="background: #0066CC; width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;">Blue</button>
                    <button class="color-btn" data-face="front" data-color="#FF8C00" style="background: #FF8C00; width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;">Orange</button>
                </div>
            </div>
            <div style="margin-bottom: 20px;">
                <label style="display: block; font-weight: 600; margin-bottom: 8px;">Right Color:</label>
                <div style="display: flex; gap: 10px;">
                    <button class="color-btn" data-face="right" data-color="#CC0000" style="background: #CC0000; width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;">Red</button>
                    <button class="color-btn" data-face="right" data-color="#00AA00" style="background: #00AA00; width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;">Green</button>
                    <button class="color-btn" data-face="right" data-color="#0066CC" style="background: #0066CC; width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;">Blue</button>
                    <button class="color-btn" data-face="right" data-color="#FF8C00" style="background: #FF8C00; width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;">Orange</button>
                </div>
            </div>
            <div style="margin-bottom: 20px;">
                <label style="display: block; font-weight: 600; margin-bottom: 8px;">Back Color:</label>
                <div style="display: flex; gap: 10px;">
                    <button class="color-btn" data-face="back" data-color="#CC0000" style="background: #CC0000; width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;">Red</button>
                    <button class="color-btn" data-face="back" data-color="#00AA00" style="background: #00AA00; width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;">Green</button>
                    <button class="color-btn" data-face="back" data-color="#0066CC" style="background: #0066CC; width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;">Blue</button>
                    <button class="color-btn" data-face="back" data-color="#FF8C00" style="background: #FF8C00; width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;">Orange</button>
                </div>
            </div>
            <div style="margin-bottom: 20px;">
                <label style="display: block; font-weight: 600; margin-bottom: 8px;">Left Color:</label>
                <div style="display: flex; gap: 10px;">
                    <button class="color-btn" data-face="left" data-color="#CC0000" style="background: #CC0000; width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;">Red</button>
                    <button class="color-btn" data-face="left" data-color="#00AA00" style="background: #00AA00; width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;">Green</button>
                    <button class="color-btn" data-face="left" data-color="#0066CC" style="background: #0066CC; width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;">Blue</button>
                    <button class="color-btn" data-face="left" data-color="#FF8C00" style="background: #FF8C00; width: 60px; height: 40px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer;">Orange</button>
                </div>
            </div>
            <div style="margin-bottom: 20px; margin-top: 20px;">
                <label style="display: block; font-weight: 600; margin-bottom: 8px;">Scramble Image Size: <span id="sizeValue">200</span>px</label>
                <input type="range" id="imageSizeSlider" min="100" max="400" step="10" value="200" style="width: 100%; cursor: pointer;" oninput="updateImageSizePreview(this.value)">
                <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #666; margin-top: 5px;">
                    <span>Small (100px)</span>
                    <span>Large (400px)</span>
                </div>
            </div>
            <div style="margin-top: 20px; text-align: center;">
                <button onclick="saveColorScheme()" style="padding: 10px 30px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem; font-weight: 600;">Save Color Scheme</button>
                <button onclick="resetColorScheme()" style="padding: 10px 30px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 1rem; font-weight: 600; margin-left: 10px;">Reset to Default</button>
            </div>
        </div>
    </div>
</div>

<div id="howToUseModal" class="modal">
  <div class="modal-content" style="max-width: 850px; margin-top: 50px; border-radius: 14px; overflow: hidden;">
    <div class="modal-header" style="background: linear-gradient(135deg, #007bff 0%, #17a2b8 100%); color: white; padding: 18px 25px;">
      <span class="modal-title" style="font-size: 1.6rem; font-weight: 700;">How to Use This App</span>
      <button class="close-btn" onclick="closeHowToUseModal()" style="color: white; font-size: 1.8rem;">&times;</button>
    </div>

    <div class="modal-body" style="max-height: 75vh; overflow-y: auto; padding: 25px 30px; background: #fdfdfd; color: #222; line-height: 1.75; font-family: 'Segoe UI', sans-serif;">
      
      <h2 style="margin-top: 0; color: #007bff; font-weight: 700;">Welcome to Square-1 Cubeshape Parity Trainer!</h2>
      <p style="font-size: 1.05rem; color: #555;">This short guide explains all the features and settings of the app so you can make the most out of it ‚Äî from basic tracking to advanced parity analysis.</p>

      <!-- Section: Basic Features -->
      <div style="margin-top: 25px;">
        <h3 style="color: #2d3748; font-weight: 700;">üß© Basic Features</h3>
        <ul style="padding-left: 20px; margin-top: 10px;">
          <li>All <strong>90 cubeshapes</strong> are displayed in individual cards.</li>
          <li>Click the checkmark on a card to change a case‚Äôs state: <em>Unlearned ‚Üí Learning ‚Üí Learned</em>.</li>
          <li>The top bar shows your learning progress, learned probability coverage, and your estimated ‚Äúparity safety‚Äù percentage.</li>
          <li>You can search cubeshapes by name or by their alternative names, and sort or filter them based on your needs.</li>
          <li>Each case name is clickable. Clicking it opens a detailed window where you‚Äôll find setup moves, a note section where you can write hints for that case, and a training option that will generate random scramble for the case directly using <strong>csTimer's</strong> csp trainer. It has many more advanced features that are explained inside the advanced feature section.</li>
          <li>Each case's note is directly visible on the homepage so that you can just look at the hint if you forget or need just a peek to remember a case's algorithm</li>
        </ul>
      </div>

      <hr style="border:none; border-top:2px solid #eee; margin:30px 0;">

      <!-- Section: Advanced Features -->
      <div style="margin-top: 20px;">
        <h3 style="color: #2d3748; font-weight: 700;">Advanced Features</h3>
        <p>The <strong>Settings</strong> menu provides advanced tools to help you customize your learning experience and how parity information is displayed.</p>
        
        <div style="background:#f8fbff; border-left:5px solid #007bff; border-radius:8px; padding:15px 18px; margin-top:15px;">
          <h4 style="margin:0; color:#007bff; font-size:1.05rem;">Show Tracing Guides</h4>
          <p style="margin-top:5px;">This will show the tracing path I personally use; and if you don't know what you are doing yet, you can just mimic my tracing path for simplicity.</p>
        </div>

        <div style="background:#f8fbff; border-left:5px solid #007bff; border-radius:8px; padding:15px 18px; margin-top:15px;">
          <h4 style="margin:0; color:#007bff; font-size:1.05rem;">Show Shape Paths</h4>
          <p style="margin-top:5px;">Adds a section in the case details showing how the cubeshape changes as it is solved using an algorithm.</p>
        </div>

        <div style="background:#f8fbff; border-left:5px solid #007bff; border-radius:8px; padding:15px 18px; margin-top:15px;">
          <h4 style="margin:0; color:#007bff; font-size:1.05rem;">Enable Priority-Based Learning</h4>
          <p style="margin-top:5px;">Lets you organize cases into seven priority levels (from <em>Top</em> to <em>Meh</em>). You can then sort the grid by these levels to focus on what matters most first.</p>
        </div>

        <div style="background:#f8fbff; border-left:5px solid #007bff; border-radius:8px; padding:15px 18px; margin-top:15px;">
          <h4 style="margin:0; color:#007bff; font-size:1.05rem;">Dynamically Decide Even/Odd</h4>
          <p style="margin-top:5px;">Applies Kale‚Äôs parity tracing logic directly to each algorithm to automatically decide if it solves an even or odd parity case. You can set your tracing orientation in <em>Parity Orientation Settings</em> and get your personalized csp algorithm app that will show exactly the alg you are to use</p>
        </div>

        <div style="background:#f8fbff; border-left:5px solid #007bff; border-radius:8px; padding:15px 18px; margin-top:15px;">
          <h4 style="margin:0; color:#007bff; font-size:1.05rem;">Case Name Settings</h4>
          <p style="margin-top:5px;">Allows you to rename cubeshapes, customize Left/Right prefixes, or swap them if you prefer mirrored naming conventions.</p>
        </div>

        <div style="background:#f8fbff; border-left:5px solid #007bff; border-radius:8px; padding:15px 18px; margin-top:15px;">
          <h4 style="margin:0; color:#007bff; font-size:1.05rem;">Data Export and Import</h4>
          <p style="margin-top:5px;">Since the app doesn‚Äôt yet use an online database, your progress is stored locally. You can export it as a JSON file and import it later to restore your data.</p>
        </div>

        <div style="background:#f8fbff; border-left:5px solid #007bff; border-radius:8px; padding:15px 18px; margin-top:15px;">
          <h4 style="margin:0; color:#007bff; font-size:1.05rem;">Parity Analysis Shortcut</h4>
          <p style="margin-top:5px;">Clicking the underlined word <strong>‚ÄúParity‚Äù</strong> in the app‚Äôs title opens Kale‚Äôs Parity Tracer ‚Äî a tool that analyzes parity directly from any scramble using your orientation settings.</p>
        </div>
      </div>

      <hr style="border:none; border-top:2px solid #eee; margin:35px 0;">

      <!-- Section: Parity Orientation -->
      <div style="margin-top:20px;">
        <h3 style="color:#2d3748; font-weight:700;">Setting Up Parity Orientation</h3>
        <p>In regular parity deduction, you might use two different starting points ‚Äî one for corners and one for edges. In this app, you‚Äôll only set one starting point, which works for both. Here‚Äôs how to do it correctly:</p>

        <ol style="padding-left:20px; margin-top:10px;">
          <li>Choose a position where the <strong>first corner clockwise</strong> is your first traced corner.</li>
          <li>Make sure the <strong>first edge clockwise</strong> is your first traced edge as well.</li>
        </ol>

        <p style="margin-top:12px; color:#444;">If your starting corner and edge are on two different sides of the cubeshape, or if you trace parity counterclockwise, then <strong>you are gay, you are queer, you have failed my app, you have failed humanity, and nobody loves you</strong>.</p> <hr><br>
        <p> Use the app in landscape mode for full experience.</p>
      </div>

    </div>
  </div>
</div>


<!-- üåü Updated Suggest Modal -->
<div id="suggestModal" class="modal">
  <div class="modal-content" style="max-width: 700px; margin-top: 60px; border-radius: 14px; overflow: hidden;">
    <div class="modal-header" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 18px 25px;">
      <span class="modal-title" style="font-size: 1.5rem; font-weight: 700;">üí° Suggest Updates or Report Bugs</span>
      <button class="close-btn" onclick="closeSuggestModal()" style="color: white; font-size: 1.8rem;">&times;</button>
    </div>
    <div class="modal-body" style="max-height: 70vh; overflow-y: auto; background: #fdfdfd; padding: 25px 30px; color: #333; font-family: 'Segoe UI', sans-serif; line-height: 1.7;">
      <p style="font-size: 1.05rem;">If you think any new feature would make the app better, or if you found any bug, wrong or wrongly labeled algorithm, wrong cases showing up inside training, then let me know via email. (I am most probably gonna ignore it anyways)</p>
      
      <div style="background: #f8fff9; border-left: 5px solid #28a745; border-radius: 8px; padding: 15px 18px; margin-top: 15px;">
        <a href="mailto:abidashrafkhulna@gmail.com?subject=%5BSquare-1%20Parity%20App%5D%20Feedback%20or%20Bug%20Report&body=Hey%20Abid!%0D%0A%0D%0AHere's%20what%20I%20wanted%20to%20share:%0D%0A%0D%0A---%0D%0A(Please%20describe%20your%20suggestion%20or%20bug%20here)%0D%0A%0D%0AApp%20Version:%20v1.0%0D%0ADevice/Browser:%20" 
          style="display: inline-block; margin-top: 10px; background: #28a745; color: white; text-decoration: none; padding: 10px 18px; border-radius: 6px; font-weight: 600;">Email Me</a>
      </div>

      <p style="margin-top: 25px;">This app is <strong>open source</strong>. You can explore the code, or make your own tweaks and redistribute an even improved version of this app, I won't mind.</p>
      <p><a href="https://github.com/your-github-link" target="_blank" style="color: #007bff; text-decoration: none; font-weight: 600;">üåê Visit the GitHub Repository</a></p>
    </div>
  </div>
</div>

<!-- üåô Updated Confession Modal -->
<div id="confessionModal" class="modal">
  <div class="modal-content" style="max-width: 700px; margin-top: 60px; border-radius: 14px; overflow: hidden;">
    <div class="modal-header" style="background: linear-gradient(135deg, #6c757d, #343a40); color: white; padding: 18px 25px;">
      <span class="modal-title" style="font-size: 1.5rem; font-weight: 700;">A Small Confession</span>
      <button class="close-btn" onclick="closeConfessionModal()" style="color: white; font-size: 1.8rem;">&times;</button>
    </div>
    <div class="modal-body" style="max-height: 70vh; overflow-y: auto; background: #fdfdfd; padding: 25px 30px; color: #333; font-family: 'Segoe UI', sans-serif; line-height: 1.75;">
      <p><strong>Honest moment:</strong> this app started as a passion project inspired by <em>Hashtag Cuber‚Äôs Cubeshape Parity</em> webpage.</p>
      <p>I used a few of her assets and algorithms (tweaked and fixed along the way), though I‚Äôm still unsure about the licensing terms. I couldn‚Äôt find a way to contact <strong>Eva Kato</strong>, the creator ‚Äî if anyone knows how to reach her, please do let me know!</p>

      <p>Originally, this was meant to be a private learning tool ‚Äî a kind of ‚Äúcertificate‚Äù of my wild vibe-coding journey. But it turned out so useful that I decided to share it publicly, hoping it helps others too.</p>

      <div style="background: #fff6e6; border-left: 5px solid #ffc107; border-radius: 8px; padding: 15px 18px; margin-top: 15px;">
        <p style="margin: 0;"> If Eva (or anyone who personally know her) prefers this to be taken down or modified, I‚Äôll happily replace all borrowed parts with original content immediately.</p>
      </div>

      <p style="margin-top: 20px;">The scramble generator was adapted from <strong>csTimer‚Äôs</strong> open code. And fun fact ‚Äî almost the entire app (except that part) was written entirely by AI large language models ‚Äî mainly <em>Claude Sonnet 4.5</em> and a bit of chatGPT.</p>

      <p style="margin-top: 20px; font-size: 0.9rem; color: #555;">If you‚Äôd like to discuss or help make it more original, feel free to reach out:</p>
      <a href="mailto:abidashrafkhulna@gmail.com?subject=%5BSquare-1%20Parity%20App%5D%20Regarding%20Original%20Sources&body=Hey%20Abid!%0D%0AI'd%20like%20to%20discuss%20the%20app%20and%20original%20source%20content.%0D%0A" 
        style="display: inline-block; background: #6c757d; color: white; text-decoration: none; padding: 10px 18px; border-radius: 6px; font-weight: 600; margin-top: 8px;">‚úâÔ∏è Contact Me</a>
    </div>
  </div>
</div>

<script src="src/js/svgs/svg.js"></script>
<script src="src/js/lib/database/shapeIndex.js"></script>
<script src="src/js/lib/database/algs.js"></script>
<script src="src/js/lib/tools/kalesParityTracer.js"></script>
<script src="src/js/lib/tools/scramblegenerator.js"></script>
<script src="src/js/lib/tools/draw-scramble.js"></script>
<script src="src/js/display/rendering/scrambleFormatting.js"></script>
<script src="src/js/js/constants-and-config.js"></script>

<script id="src/js/js/state-management.js">

let filteredData = [...data];
let learnedCases = new Set();
let learningCases = new Set();
let plannedCases = new Set();
let swappedCases = new Map(); // stores {caseName: true/false}
let comments = new Map(); // stores {caseName: "comment text"}
let plannedLevels = new Map(); // stores {caseName: 1-6}
let perCaseSwapLR = new Map(); // stores {caseName: true/false} for per-case L/R swap
let parityOrientations = new Map(); // stores {shapePattern: rotationAmount}

// User's saved preferences
let caseNameSettings = new Map(); // Stores {shape: "SelectedName"}
let customCaseNames = new Map();  // Stores {shape: "CustomText"}
let swapShapeLR = new Map();      // Stores {shape: true/false} for swapping L/R at the base shape level
let useDynamicParity = false;     // Toggle for dynamic parity determination
let showPaths = false;        // Toggle for short Left/Right notation (L. /R. )
let lrPosition = 'front';         // Position of L/R prefix: 'front' or 'back'
let enablePriorityLearning = false; // Toggle for priority-based learning system
// --- End New Case Name Settings ---
let useShortLR = false;
let showHints = localStorage.getItem('showHints') !== null ? localStorage.getItem('showHints') === 'true' : true; // Default to true
let colorScheme = {
    topColor: '#000000',
    bottomColor: '#FFFFFF',
    frontColor: '#CC0000',
    rightColor: '#00AA00',
    backColor: '#FF8C00',
    leftColor: '#0066CC',
    dividerColor: '#7a0000',
    circleColor: 'transparent'
};

let scrambleImageSize = 200; // Default size

// Check if this is first load BEFORE loading state
const isFirstLoad = !localStorage.getItem('sq1-parity-progress');

// Load saved state
try {
    const saved = localStorage.getItem('sq1-parity-progress');
    if (saved) {
        const state = JSON.parse(saved);
        learnedCases = new Set(state.learned || []);
        learningCases = new Set(state.learning || []);
        plannedCases = new Set(state.planned || []);
        swappedCases = new Map(Object.entries(state.swapped || {}));
        comments = new Map(Object.entries(state.comments || {}));
        plannedLevels = new Map(Object.entries(state.plannedLevels || {}));
        perCaseSwapLR = new Map(Object.entries(state.perCaseSwapLR || {}));
        parityOrientations = new Map(Object.entries(state.parityOrientations || {}));
        // Load new name settings
        caseNameSettings = new Map(Object.entries(state.caseNameSettings || {}));
        customCaseNames = new Map(Object.entries(state.customCaseNames || {}));
        swapShapeLR = new Map(Object.entries(state.swapShapeLR || {}));
        useDynamicParity = state.useDynamicParity || false;
        showPaths = state.showPaths || false;
        useShortLR = state.useShortLR !== undefined ? state.useShortLR : true;
        lrPosition = state.lrPosition || 'front';
        enablePriorityLearning = state.enablePriorityLearning || false;
        colorScheme = state.colorScheme || colorScheme;
        scrambleImageSize = state.scrambleImageSize || 200;
    }
    
    // Initialize all cases as planned with priority 4 (Normal) if not already set
    data.forEach(item => {
        if (!learnedCases.has(item.name) && !learningCases.has(item.name) && !plannedCases.has(item.name)) {
            plannedCases.add(item.name);
            plannedLevels.set(item.name, 4);
        }
        if (!plannedLevels.has(item.name) && plannedCases.has(item.name)) {
            plannedLevels.set(item.name, 4);
        }
    });
    saveState();
} catch (e) {
    console.error('Error loading saved state:', e);
}


// Set defaults if this is first load
if (isFirstLoad) {
    // Set showHints to true for first load
    showHints = true;
    localStorage.setItem('showHints', 'true');
    // Default case name settings
    caseNameSettings.set('Paired Edges', 'Pair');
    caseNameSettings.set('Perpendicular Edges', 'L-Shape');
    caseNameSettings.set('Parallel Edges', 'Line');
    
    // Default toggles
    useShortLR = true;
    lrPosition = 'front';
    showPaths = true;
    showHints = true;  // Changed to true for tracing guides
    useDynamicParity = false;
    enablePriorityLearning = false;
    
    // Default sort
    sortSelect.value = 'probability';
    
    saveState();
}

// Apply case name defaults if not already set (for existing users too)
if (!caseNameSettings.has('Paired Edges')) {
    caseNameSettings.set('Paired Edges', 'Pair');
}
if (!caseNameSettings.has('Perpendicular Edges')) {
    caseNameSettings.set('Perpendicular Edges', 'L-Shape');
}
if (!caseNameSettings.has('Parallel Edges')) {
    caseNameSettings.set('Parallel Edges', 'Line');
}

function saveState() {
    try {
        localStorage.setItem('sq1-parity-progress', JSON.stringify({
            learned: Array.from(learnedCases),
            learning: Array.from(learningCases),
            planned: Array.from(plannedCases),
            swapped: Object.fromEntries(swappedCases),
            comments: Object.fromEntries(comments),
            plannedLevels: Object.fromEntries(plannedLevels),
            perCaseSwapLR: Object.fromEntries(perCaseSwapLR),
            parityOrientations: Object.fromEntries(parityOrientations),
            // Save new name settings
            caseNameSettings: Object.fromEntries(caseNameSettings),
            customCaseNames: Object.fromEntries(customCaseNames),
            swapShapeLR: Object.fromEntries(swapShapeLR),
            useDynamicParity: useDynamicParity,
            showPaths: showPaths,
            useShortLR: useShortLR,
            lrPosition: lrPosition,
            enablePriorityLearning: enablePriorityLearning,
            colorScheme: colorScheme,
            scrambleImageSize: scrambleImageSize
        }));
    } catch (e) {
        console.error('Error saving state:', e);
    }
}

function exportData() {
    const state = {
        learned: Array.from(learnedCases),
        learning: Array.from(learningCases),
        planned: Array.from(plannedCases),
        swapped: Object.fromEntries(swappedCases),
        comments: Object.fromEntries(comments),
        plannedLevels: Object.fromEntries(plannedLevels),
        perCaseSwapLR: Object.fromEntries(perCaseSwapLR),
        parityOrientations: Object.fromEntries(parityOrientations),
        caseNameSettings: Object.fromEntries(caseNameSettings),
        customCaseNames: Object.fromEntries(customCaseNames),
        swapShapeLR: Object.fromEntries(swapShapeLR),
        useDynamicParity: useDynamicParity,
        showPaths: showPaths,
        showHints: showHints,
        colorScheme: colorScheme,
            scrambleImageSize: scrambleImageSize
    };
    const dataStr = JSON.stringify(state, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'sq1-parity-progress.json';
    link.click();
    URL.revokeObjectURL(url);
}

function importData(jsonStr) {
    try {
        const state = JSON.parse(jsonStr);
        learnedCases = new Set(state.learned || []);
        learningCases = new Set(state.learning || []);
        plannedCases = new Set(state.planned || []);
        swappedCases = new Map(Object.entries(state.swapped || {}));
        comments = new Map(Object.entries(state.comments || {}));
        plannedLevels = new Map(Object.entries(state.plannedLevels || {}));
        perCaseSwapLR = new Map(Object.entries(state.perCaseSwapLR || {}));
        parityOrientations = new Map(Object.entries(state.parityOrientations || {}));
        caseNameSettings = new Map(Object.entries(state.caseNameSettings || {}));
        customCaseNames = new Map(Object.entries(state.customCaseNames || {}));
        swapShapeLR = new Map(Object.entries(state.swapShapeLR || {}));
        useDynamicParity = state.useDynamicParity || false;
        showPaths = state.showPaths || false;
        colorScheme = state.colorScheme || colorScheme;
        if (state.showHints !== undefined) {
            showHints = state.showHints;
            localStorage.setItem('showHints', showHints);
            applyHintVisibility();
        }
        saveState();
        updateProgress();
        render();
        alert('Data imported successfully!');
    } catch (e) {
        alert('Error importing data: ' + e.message);
    }
}

function handleFileImport(file) {
    const reader = new FileReader();
    reader.onload = (e) => importData(e.target.result);
    reader.readAsText(file);
}

// DOM element references
const searchInput = document.getElementById('search');
const sortSelect = document.getElementById('sort');
const learnFilterSelect = document.getElementById('learnFilter');
const grid = document.getElementById('grid');
const progressText = document.getElementById('progress-text');
const safetyText = document.getElementById('safety-text');

</script>
<script src="src/js/display/rendering/display-names.js"></script>
<script src="src/js/display/rendering/algorithm-display.js"></script>
<script src="src/js/display/rendering/search-and-filter.js"></script>
<script src="src/js/js/learning-state.js"></script>
<script src="src/js/display/rendering/card-rendering.js"></script>
<script src="src/js/lib/tools/scramble-generator.js"></script>
<script src="src/js/display/modals/modal-case-details.js"></script>
<script src="src/js/display/modals/modal-settings.js"></script>
<script src="src/js/display/modals/modal-case-names.js"></script>
<script src="src/js/display/modals/modal-parity-orientation.js"></script>
<script src="src/js/display/modals/modal-parity-analysis.js"></script>
<script src="src/js/display/modals/modal-info.js"></script>
<script src="src/js/display/modals/training-modal.js"></script>
<script id="src/js/js/global-event-handlers.js">

document.addEventListener('keydown', function (e) {
    if (e.key === 'Escape') {
        closeModal();
    }
});

// Drag and drop support
document.body.addEventListener('dragover', (e) => {
    e.preventDefault();
});

document.body.addEventListener('drop', (e) => {
    e.preventDefault();
    const files = e.dataTransfer.files;
    if (files.length > 0 && files[0].name.endsWith('.json')) {
        handleFileImport(files[0]);
    }
});

// Close modals when clicking outside
window.onclick = function(event) {
    const settingsModal = document.getElementById('settingsModal');
    const caseNameModal = document.getElementById('caseNameModal');
    const parityModal = document.getElementById('parityOrientationModal');
    const parityAnalysisModal = document.getElementById('parityAnalysisModal');
    const howToUseModal = document.getElementById('howToUseModal');
    const suggestModal = document.getElementById('suggestModal');
    const confessionModal = document.getElementById('confessionModal');
    const colorSchemeModal = document.getElementById('colorSchemeModal');
    const trainingModal = document.getElementById('trainingModal');
    
    if (event.target == settingsModal) {
        closeSettingsModal();
    }
    if (event.target == caseNameModal) {
        closeCaseNameModal();
    }
    if (event.target == parityModal) {
        closeParityOrientationModal();
    }
    if (event.target == parityAnalysisModal) {
        closeParityAnalysisModal();
    }
    if (event.target == colorSchemeModal) {
        closeColorSchemeModal();
    }
    if (trainingModal && event.target == trainingModal) {
        closeTrainingModal();
    }
    if (event.target == howToUseModal) {
        closeHowToUseModal();
    }
    if (event.target == suggestModal) {
        closeSuggestModal();
    }
    if (event.target == confessionModal) {
        closeConfessionModal();
    }
}

// Close modal if clicking outside the content
window.onclick = function(event) {
    if (event.target == settingsModal) {
        closeSettingsModal();
    }
    if (event.target == caseNameModal) {
        closeCaseNameModal();
    }
}

// Handle back button navigation for mobile devices
let backButtonHandlerActive = false;

function setupBackButtonHandler() {
    if (backButtonHandlerActive) return;
    backButtonHandlerActive = true;
    
    // Push a dummy state to handle back button
    window.history.pushState({ modal: false }, '');
    
    window.addEventListener('popstate', function(event) {
        // Check if any modal is open
        const openModals = [
            document.getElementById('settingsModal'),
            document.getElementById('caseNameModal'),
            document.getElementById('parityOrientationModal'),
            document.getElementById('parityAnalysisModal'),
            document.getElementById('howToUseModal'),
            document.getElementById('suggestModal'),
            document.getElementById('confessionModal'),
            document.getElementById('colorSchemeModal'),
            document.getElementById('trainingModal'),
            document.getElementById('shapeIndexSelectorModal')
        ].filter(modal => modal && (modal.style.display === 'block' || modal.classList.contains('active')));
        
        if (openModals.length > 0) {
            // Close the topmost modal
            const topModal = openModals[openModals.length - 1];
            
            if (topModal.id === 'trainingModal') closeTrainingModal();
            else if (topModal.id === 'settingsModal') closeSettingsModal();
            else if (topModal.id === 'caseNameModal') closeCaseNameModal();
            else if (topModal.id === 'parityOrientationModal') closeParityOrientationModal();
            else if (topModal.id === 'parityAnalysisModal') closeParityAnalysisModal();
            else if (topModal.id === 'colorSchemeModal') closeColorSchemeModal();
            else if (topModal.id === 'howToUseModal') closeHowToUseModal();
            else if (topModal.id === 'suggestModal') closeSuggestModal();
            else if (topModal.id === 'confessionModal') closeConfessionModal();
            else if (topModal.id === 'shapeIndexSelectorModal') closeShapeIndexSelector();
            
            // Push state again to keep the handler active
            window.history.pushState({ modal: false }, '');
        } else {
            // No modals open, ask if user wants to exit
            if (confirm('Do you want to exit the app?')) {
                window.history.back(); // Actually go back (will close the tab/app)
            } else {
                // Stay on the page
                window.history.pushState({ modal: false }, '');
            }
        }
    });
}

// Setup back button handler on page load
setupBackButtonHandler();

</script>
<script id="src/js/js/initialization.js">

// Initialize priority option visibility
const priorityOption = document.getElementById('sortPriority');
if (priorityOption) {
    priorityOption.style.display = enablePriorityLearning ? 'block' : 'none';
}

// Loading tips object
const loadingTips = {
    firstLoad: [
        "Reading the 'How to Use' instructions can help you discover hidden features of the app.",
    ],
    general: [
        "Happy Learning.",
    ]
};

// Select and display a random tip
const tipElement = document.createElement('p');
tipElement.style.cssText = 'font-size: 0.95rem; color: #555; margin-top: 20px; max-width: 500px; text-align: center; line-height: 1.5;';
const tips = isFirstLoad ? loadingTips.firstLoad : loadingTips.general;
const randomTip = tips[Math.floor(Math.random() * tips.length)];
tipElement.textContent = randomTip;
document.getElementById('loadingScreen').appendChild(tipElement);

// Loading screen progress simulation
let loadProgress = 0;
const progressBar = document.getElementById('loadingProgress');
const loadingInterval = setInterval(() => {
    loadProgress += Math.random() * 30;
    if (loadProgress > 90) loadProgress = 90;
    progressBar.style.width = loadProgress + '%';
}, 100);

updateProgress();
filterAndSort();

// Complete loading and show content
window.addEventListener('load', async () => {
    await new Promise(resolve => setTimeout(resolve, 300));
    
    clearInterval(loadingInterval);
    progressBar.style.width = '100%';
    
    await new Promise(resolve => setTimeout(resolve, 200));
    
    document.getElementById('loadingScreen').style.opacity = '0';
    document.querySelector('.container').style.opacity = '1';
    
    await new Promise(resolve => setTimeout(resolve, 300));
    
    document.getElementById('loadingScreen').style.display = 'none';
    
    // Show how to use modal on first load - wait 1.5 seconds after everything is rendered
    if (isFirstLoad) {
        await new Promise(resolve => setTimeout(resolve, 1500));
        openHowToUseModal();
    }
});

</script>
<script>
// Register service worker
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/serviceworker.js')
            .then(registration => {
                console.log('ServiceWorker registered:', registration.scope);
            })
            .catch(err => {
                console.log('ServiceWorker registration failed:', err);
            });
    });
}
</script>
</body>

</html>